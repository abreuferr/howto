#: Title : senhasegura e certificado digital
#: Author : "Caio Abreu Ferreira" <abreuferr_gmail.com>
#: Description : estudo sobre o software senhasegura e certificado digital
#: Options : None

$ sudo su

$ openssl genrsa -aes256 -out senhasegura_password.key 2048

$ openssl rsa -in senhasegura_password.key -out senhasegura.key

$ openssl req -new -sha256 -nodes -out senhasegura.csr -key senhasegura.key -config <(
cat <<-EOF
[req]
default_bits = 2048
prompt = no
default_md = sha256
req_extensions = req_ext
distinguished_name = dn

[ dn ]
C=BR
ST=Sao Paulo
L=Sao Paulo
O=senhasegura
CN = vmdf-senseg.senhasegura.local

[ req_ext ]
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = vmdf-senseg.senhasegura.local
DNS.2 = *.senhasegura.local
EOF
)

$ openssl x509 -in senhasegura.csr -out senhasegura.crt -req -signkey senhasegura.key -days 365

$ cp senhasegura.* /etc/ssl/localcerts/

$ vim /etc/nginx/sites-enabled/senhasegura
    (...)
    #   ssl_certificate /etc/ssl/localcerts/ss-self.bundle.crt;
    #   ssl_certificate_key /etc/ssl/localcerts/ss-self.key;
 
    ssl_certificate /etc/ssl/localcerts/senhasegura.crt;
    ssl_certificate_key /etc/ssl/localcerts/senhasegura.key;
    (...)

$ service nginx configtest

$ service nginx restart

$ service nginx status
